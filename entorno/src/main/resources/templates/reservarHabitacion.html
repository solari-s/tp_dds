<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reservar habitación</title>

<style>
/* ---------------------- ESTILO GENERAL CLARO ---------------------- */
body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    background:#e7eff9;
}

.window{
    width:95%;
    margin:20px auto;
    background:#f4f7fc;
    border-radius:14px;
    box-shadow:0 0 12px rgba(0,0,0,0.12);
    padding:25px;
}

/* Título */
.title{
    text-align:center;
    font-size:24px;
    margin-bottom:20px;
}

/* Fila select + botón */
.row{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:14px;
    margin-bottom:25px;
}

select{
    padding:10px 20px;
    font-size:16px;
    border-radius:10px;
    border:1px solid #c7d3e0;
    background:white;
}

button{
    padding:10px 22px;
    background:#c7d9f7;
    border:none;
    border-radius:20px;
    cursor:pointer;
    font-size:16px;
}

button:hover{
    background:#b5cbf5;
}

/* ---------------------- CONTENEDOR PRINCIPAL ---------------------- */
.main-box{
    background:white;
    border-radius:16px;
    border:1px solid #dde6f2;
    padding:18px;
    margin-top:10px;
}

/* ---------------------- TABS ---------------------- */
.tabs{
    display:flex;
    gap:4px;
    margin:0 auto 15px auto;
    width:max-content;
}

.tab{
    padding:8px 18px;
    font-size:14px;
    background:#f2f2f2;
    border:1px solid #ccc;
    border-bottom:none;
    border-radius:10px 10px 0 0;
    cursor:pointer;
}

.tab.active{
    background:white;
    border-bottom:1px solid white;
}

/* ---------------------- TABLA ---------------------- */
.table-box{
    border:1px solid #d3d7de;
    border-radius:14px;
    padding:10px;
    height:350px;
    overflow-y:auto;
}

table{
    width:100%;
    border-collapse:collapse;
}

th{
    background:#ececec;
    padding:10px;
    border:1px solid #ccc;
    text-align:center;
    font-weight:600;
}

td{
    padding:12px;
    border:1px solid #ccc;
    text-align:center;
}

/* Colores */
.disp{
    background:#b7e3a0; /* verde */
}
.no-disp{
    background:#c5c5c5; /* gris */
}

/* ---------------------- BOTÓN RESERVAR ---------------------- */
.reserve-btn{
    margin-top:20px;
    display:flex;
    justify-content:flex-end;
}

.reserve-btn button{
    background:#c7d9f7;
    border-radius:18px;
}

/* Scrollbar */
.table-box::-webkit-scrollbar{
    width:14px;
}
.table-box::-webkit-scrollbar-track{
    background:#e6edf7;
    border-radius:10px;
}
.table-box::-webkit-scrollbar-thumb{
    background:#b4c2dd;
    border-radius:10px;
}
</style>
</head>

<body>

<div class="window">

    <div class="title">Reservar habitación</div>

    <div class="row">
        <label>Tipo de habitación:</label>
        <select id="tipo">
            <option>Select</option>
            <option>Individual estándar</option>
            <option>Doble estándar</option>
            <option>Doble superior</option>
            <option>Superior family plan</option>
            <option>Suite doble</option>
        </select>

        <button onclick="buscar()">Buscar</button>
    </div>

    <div class="main-box">

        <h3 style="text-align:center;margin-top:0;">Habitaciones disponibles</h3>

        <!-- TABS -->
        <div class="tabs">
            <div class="tab active">Individual estándar</div>
            <div class="tab">Doble estándar</div>
            <div class="tab">Doble superior</div>
            <div class="tab">Superior family plan</div>
            <div class="tab">Suite doble</div>
        </div>

        <!-- TABLA -->
        <div class="table-box">
            <table id="tabla">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>SD1</th>
                        <th>SD2</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Se rellena por JS -->
                </tbody>
            </table>
        </div>

        <div class="reserve-btn">
            <button onclick="reservar()">Reservar</button>
        </div>

    </div>
</div>

<script>

    const paramsFechas = new URLSearchParams(window.location.search);

    const fechaDesde = params.get("desde");
    const fechaHasta = params.get("hasta");

    console.log("Fechas recibidas:", fechaDesde, fechaHasta);

    // URL base de tu API Spring Boot
    const API_URL = "http://localhost:8080/api/reservas";

    /* ---------------------- FUNCION BUSCAR (GET) ---------------------- */
    async function buscar() {
    const combo = document.getElementById("tipo");
    const tipo = combo.value;

    if (tipo === "Select") {
        alert("Por favor, selecciona un tipo de habitación.");
        return;
    }

    if (!fechaDesde || !fechaHasta) {
        alert("Error: no se recibieron fechas desde CU5.");
        return;
    }

    try {
        // Llamada real al backend con TIPO + RANGO
        const response = await fetch(`${API_URL}/buscar?tipo=${tipo}&desde=${fechaDesde}&hasta=${fechaHasta}`);

        if (response.ok) {
            const datos = await response.json();
            cargarTabla(datos);
        } else {
            alert("Error al obtener datos del servidor.");
        }
    } catch (e) {
        console.error("Error de conexión:", e);
        alert("No se pudo conectar con el servidor.");
    }
}


    /* ---------------------- CARGAR TABLA ---------------------- */
    function cargarTabla(datos) {
        const tbody = document.querySelector("#tabla tbody");
        tbody.innerHTML = ""; // Limpiar tabla anterior

        if (datos.length === 0) {
            tbody.innerHTML = "<tr><td colspan='3'>No hay datos disponibles para estas fechas.</td></tr>";
            return;
        }

        datos.forEach(item => {
            const tr = document.createElement("tr");

            // Usamos las claves del MAPA de Java: fecha, sd1 (hab1), sd2 (hab2)
            tr.innerHTML = `
                <td>${item.fecha}</td>
                <td class="${item.sd1 ? 'disp' : 'no-disp'}">H1</td>
                <td class="${item.sd2 ? 'disp' : 'no-disp'}">H2</td>
            `;
            tbody.appendChild(tr);
        });
    }

    /* ---------------------- FUNCION RESERVAR (POST) ---------------------- */
    async function reservar() {
        // Como tu HTML no tiene campos para fecha/habitación, los pedimos por ventana emergente
        const tipo = document.getElementById("tipo").value;
        
        if (tipo === "Select") {
            alert("Primero selecciona un tipo de habitación.");
            return;
        }

        const fecha = prompt("Ingresa la fecha a reservar (dd/MM/yy):", "10/04/25");
        if (!fecha) return; // Si cancela, salimos

        const numHab = prompt("Ingresa el número de habitación (1 o 2):", "1");
        if (!numHab) return;

        try {
            // Preparamos los datos para enviar
            // Usamos URLSearchParams para simular un formulario simple (@RequestParam en Java)
            const params = new URLSearchParams();
            params.append("tipo", tipo);
            params.append("fecha", fecha);
            params.append("numero", numHab);

            // Enviamos la petición POST para GUARDAR
            const response = await fetch(`${API_URL}/crear`, {
                method: "POST",
                body: params
            });

            if (response.ok) {
                const mensaje = await response.text();
                alert(mensaje); // "Reserva exitosa"
                buscar(); // Recargamos la tabla para ver que ahora aparece roja (ocupada)
            } else {
                alert("Error al reservar. Puede que la habitación ya esté ocupada.");
            }

        } catch (e) {
            console.error(e);
            alert("Error de conexión al intentar reservar.");
        }
    }

    /* ---------------------- TABS VISUALES ---------------------- */
    document.querySelectorAll(".tab").forEach(t => {
        t.addEventListener("click", () => {
            document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
            t.classList.add("active");
            // Aquí podrías sincronizar el select si quisieras
        });
    });


    const params = new URLSearchParams(window.location.search);
    const tipoSeleccionado = params.get("tipo");

    if (tipoSeleccionado) {
        const tabs = document.querySelectorAll(".tab");
        tabs.forEach(tab => {
            if (tab.textContent.trim() === tipoSeleccionado.trim()) {
                tabs.forEach(t => t.classList.remove("active"));
                tab.classList.add("active");
            }
        });
    }


</script>

</body>
</html>
